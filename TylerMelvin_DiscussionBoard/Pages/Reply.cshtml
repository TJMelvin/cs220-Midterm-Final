@page "{ThreadId}/{PostId?}"
@model TylerMelvin_DiscussionBoard.Pages.ReplyModel
@using TylerMelvin_DiscussionBoard.Models
@{
    ViewData["Title"] = "Post a Reply to " + Model.Parent.Title;
}

<div class="container">
    <h3>@ViewData["Title"]</h3>

    <div class="card mb-3" style="border-radius: 20px;">
        <div class="card-title p-3">
            <strong>@Html.Raw(Model.Parent.Title)</strong>
        </div>
        <div class="card-body p-3">
            <p class="card-text">@Html.Raw(Model.Parent.Content)</p>
        </div>
    </div>

    <form id="form" method="post" onsubmit="handleSubmit()">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

        <div class="form-group mb-3">
            <label asp-for="Post.Title"></label>
            <input asp-for="Post.Title" class="form-control" value="@Model.Post.Title" />
            <span asp-validation-for="Post.Title" class="text-danger"></span>
        </div>

        <div class="form-group mb-3">
            <label asp-for="Post.Content"></label>
            <input type="hidden" asp-for="Post.Content" id="Post_Content" />
            <div id="body" style="min-height:200px; background:white;"></div>
            <span asp-validation-for="Post.Content" class="text-danger"></span>
        </div>

        <div class="form-group">
            <input type="submit" class="btn btn-primary" value="Submit Reply" />
        </div>
    </form>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet">

    <script>
        var toolbarOptions = [
            ['bold', 'italic', 'underline', 'strike'],
            ['blockquote', 'code-block'],
            [{ 'header': 1 }, { 'header': 2 }],
            [{ 'list': 'ordered' }, { 'list': 'bullet' }],
            ['link', 'image'],
            ['clean']
        ];

        const quill = new Quill('#body', {
            modules: {
                toolbar: toolbarOptions
            },
            theme: 'snow'
        });

        // Preload content if any
        quill.root.innerHTML = '@Html.Raw(Model.Post.Content ?? "")';

        function handleSubmit() {
            document.getElementById('Post_Content').value = quill.root.innerHTML;
        }
    </script>
}